<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notebook: run model &mdash; NEDUM-2D for CoCT  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notebook: run calibration" href="calib_nb.html" />
    <link rel="prev" title="License" href="license_rst.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> NEDUM-2D for CoCT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme_link.html">Introducing NEDUM-2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="license_rst.html">License</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Notebook: run model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Preamble">Preamble</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Import-packages">Import packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Define-file-paths">Define file paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Create-associated-directories-if-needed">Create associated directories if needed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Set-timeline-for-simulations">Set timeline for simulations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Import-parameters-and-options">Import parameters and options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#We-import-default-parameter-and-options">We import default parameter and options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#We-also-set-custom-options-for-this-simulation">We also set custom options for this simulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#We-first-set-options-regarding-structural-assumptions-used-in-the-model">We first set options regarding structural assumptions used in the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Then-we-set-options-regarding-flood-data-used">Then we set options regarding flood data used</a></li>
<li class="toctree-l4"><a class="reference internal" href="#We-also-set-options-for-scenarios-on-time-moving-exogenous-variables">We also set options for scenarios on time-moving exogenous variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Finally,-we-set-options-regarding-data-processing">Finally, we set options regarding data processing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Give-name-to-simulation-to-export-the-results">Give name to simulation to export the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Load-data">Load data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Basic-geographic-data">Basic geographic data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Macro-data">Macro data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Households-and-income-data">Households and income data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Land-use-projections">Land use projections</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#For-reference,-let-us-visualize-the-informal-settlement-risks-considered">For reference, let us visualize the informal settlement risks considered</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Let-us-visualize-land-availaibility-ay-baseline-year-(2011)">Let us visualize land availaibility ay baseline year (2011)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Import-flood-data-(takes-some-time-when-agents-anticipate-floods)">Import flood data (takes some time when agents anticipate floods)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Let-us-visualize-flood-data">Let us visualize flood data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Import-scenarios-(for-time-moving-variables)">Import scenarios (for time-moving variables)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Import-expected-income-net-of-commuting-costs-(for-all-time-periods)">Import expected income net of commuting costs (for all time periods)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Let-us-visualize-income-net-of-commuting-costs-at-baseline-year">Let us visualize income net of commuting costs at baseline year</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Compute-initial-state-equilibrium">Compute initial state equilibrium</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Let-us-visualize-key-equilibrium-outputs">Let us visualize key equilibrium outputs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Let-us-start-with-population-distribution">Let us start with population distribution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#We-may-also-look-at-housing-supply-(in-m²)">We may also look at housing supply (in m²)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Now,-let-us-look-at-land-prices-(in-rands-/-m²)">Now, let us look at land prices (in rands / m²)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Finally,-let-us-look-at-flood-damages-(in-rands)">Finally, let us look at flood damages (in rands)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Run-simulations-for-subsequent-periods-(time-depends-on-timeline-length)">Run simulations for subsequent periods (time depends on timeline length)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Output-visualization">Output visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Evolution-of-utility-levels-over-the-years">Evolution of utility levels over the years</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Evolution-of-population-sorting-across-housing-types">Evolution of population sorting across housing types</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="calib_nb.html">Notebook: run calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="guidelines.html">User guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_case.html">Use case</a></li>
<li class="toctree-l1"><a class="reference internal" href="technical_doc.html">Technical documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_tables.html">Input tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_bases.html">Data bases</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_sets.html">Data sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="math_appendix.html">Math appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_ref.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_help.html">Installation help</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NEDUM-2D for CoCT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Notebook: run model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/main_nb.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Notebook:-run-model">
<h1>Notebook: run model<a class="headerlink" href="#Notebook:-run-model" title="Permalink to this heading"></a></h1>
<div class="section" id="Preamble">
<h2>Preamble<a class="headerlink" href="#Preamble" title="Permalink to this heading"></a></h2>
<div class="section" id="Import-packages">
<h3>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We import standard Python libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="c1"># We also import our own packages</span>
<span class="kn">import</span> <span class="nn">inputs.data</span> <span class="k">as</span> <span class="nn">inpdt</span>
<span class="kn">import</span> <span class="nn">inputs.parameters_and_options</span> <span class="k">as</span> <span class="nn">inpprm</span>
<span class="kn">import</span> <span class="nn">equilibrium.compute_equilibrium</span> <span class="k">as</span> <span class="nn">eqcmp</span>
<span class="kn">import</span> <span class="nn">equilibrium.run_simulations</span> <span class="k">as</span> <span class="nn">eqsim</span>
<span class="kn">import</span> <span class="nn">equilibrium.functions_dynamic</span> <span class="k">as</span> <span class="nn">eqdyn</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="kn">import</span> <span class="nn">outputs.flood_outputs</span> <span class="k">as</span> <span class="nn">outfld</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Define-file-paths">
<h3>Define file paths<a class="headerlink" href="#Define-file-paths" title="Permalink to this heading"></a></h3>
<p>This corresponds to the architecture described in the README file (introduction tab of the documentation): the data folder is not hosted on the Github repository and should be placed in the root folder enclosing the repo.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_code</span> <span class="o">=</span> <span class="s1">&#39;..&#39;</span>
<span class="n">path_folder</span> <span class="o">=</span> <span class="n">path_code</span> <span class="o">+</span> <span class="s1">&#39;/Data/&#39;</span>
<span class="n">path_precalc_inp</span> <span class="o">=</span> <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Precalculated inputs/&#39;</span>
<span class="n">path_data</span> <span class="o">=</span> <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;data_Cape_Town/&#39;</span>
<span class="n">path_precalc_transp</span> <span class="o">=</span> <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;precalculated_transport/&#39;</span>
<span class="n">path_scenarios</span> <span class="o">=</span> <span class="n">path_data</span> <span class="o">+</span> <span class="s1">&#39;Scenarios/&#39;</span>
<span class="n">path_outputs</span> <span class="o">=</span> <span class="n">path_code</span> <span class="o">+</span> <span class="s1">&#39;/Output/&#39;</span>
<span class="n">path_floods</span> <span class="o">=</span> <span class="n">path_folder</span> <span class="o">+</span> <span class="s2">&quot;FATHOM/&quot;</span>
<span class="n">path_input_plots</span> <span class="o">=</span> <span class="n">path_outputs</span> <span class="o">+</span> <span class="s1">&#39;/input_plots/&#39;</span>
<span class="n">path_input_tables</span> <span class="o">=</span> <span class="n">path_outputs</span> <span class="o">+</span> <span class="s1">&#39;/input_tables/&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Create-associated-directories-if-needed">
<h3>Create associated directories if needed<a class="headerlink" href="#Create-associated-directories-if-needed" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_input_plots</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_input_tables</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[WinError 183] Cannot create a file when that file already exists: &#39;../Output//input_plots/&#39;
[WinError 183] Cannot create a file when that file already exists: &#39;../Output//input_tables/&#39;
</pre></div></div>
</div>
</div>
<div class="section" id="Set-timeline-for-simulations">
<h3>Set timeline for simulations<a class="headerlink" href="#Set-timeline-for-simulations" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Import-parameters-and-options">
<h2>Import parameters and options<a class="headerlink" href="#Import-parameters-and-options" title="Permalink to this heading"></a></h2>
<div class="section" id="We-import-default-parameter-and-options">
<h3>We import default parameter and options<a class="headerlink" href="#We-import-default-parameter-and-options" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inputs.parameters_and_options</span> <span class="k">as</span> <span class="nn">inpprm</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">inpprm</span><span class="o">.</span><span class="n">import_options</span><span class="p">()</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">inpprm</span><span class="o">.</span><span class="n">import_param</span><span class="p">(</span>
    <span class="n">path_precalc_inp</span><span class="p">,</span> <span class="n">path_outputs</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="We-also-set-custom-options-for-this-simulation">
<h3>We also set custom options for this simulation<a class="headerlink" href="#We-also-set-custom-options-for-this-simulation" title="Permalink to this heading"></a></h3>
<div class="section" id="We-first-set-options-regarding-structural-assumptions-used-in-the-model">
<h4>We first set options regarding structural assumptions used in the model<a class="headerlink" href="#We-first-set-options-regarding-structural-assumptions-used-in-the-model" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dummy for taking floods into account in agents&#39; choices</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;agents_anticipate_floods&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># Dummy for preventing new informal settlement development</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;informal_land_constrained&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Then-we-set-options-regarding-flood-data-used">
<h4>Then we set options regarding flood data used<a class="headerlink" href="#Then-we-set-options-regarding-flood-data-used" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dummy for taking pluvial floods into account (on top of fluvial floods)</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;pluvial&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># Dummy for reducing pluvial risk for (better protected) formal structures</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;correct_pluvial&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># Dummy for taking coastal floods into account (on top of fluvial floods)</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;coastal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># Digital elevation model to be used with coastal floods (MERITDEM or NASADEM)</span>
<span class="c1"># NB: MERITDEM is also the DEM used for fluvial and pluvial flood data</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MERITDEM&quot;</span>
<span class="c1"># Dummy for taking defended (vs. undefended) fluvial flood maps</span>
<span class="c1"># NB: FATHOM recommends to use undefended maps due to the high uncertainty</span>
<span class="c1"># in infrastructure modelling</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;defended&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># Dummy for taking sea-level rise into account in coastal flood data</span>
<span class="c1"># NB: Projections are up to 2050, based upon IPCC AR5 assessment for the</span>
<span class="c1"># RCP 8.5 scenario</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;slr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="We-also-set-options-for-scenarios-on-time-moving-exogenous-variables">
<h4>We also set options for scenarios on time-moving exogenous variables<a class="headerlink" href="#We-also-set-options-for-scenarios-on-time-moving-exogenous-variables" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NB: Must be set to 1/2/3 for low/medium/high growth scenario</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;inc_ineq_scenario&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;pop_growth_scenario&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;fuel_price_scenario&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Finally,-we-set-options-regarding-data-processing">
<h4>Finally, we set options regarding data processing<a class="headerlink" href="#Finally,-we-set-options-regarding-data-processing" title="Permalink to this heading"></a></h4>
<p>Default is set at zero to save computing time (data is simply loaded in the model).</p>
<p>NB: this is only needed to create the data for the first time, or when the source is changed, so that pre-processed data is updated.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dummy for converting small-area-level (SAL) data into grid-level data</span>
<span class="c1"># (used for result validation)</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;convert_sal_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># Dummy for computing expected income net of commuting costs on the basis</span>
<span class="c1"># of calibrated wages</span>
<span class="n">options</span><span class="p">[</span><span class="s2">&quot;compute_net_income&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Give-name-to-simulation-to-export-the-results">
<h2>Give name to simulation to export the results<a class="headerlink" href="#Give-name-to-simulation-to-export-the-results" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NB: this changes according to custom parameters of interest</span>
<span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;floods&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;agents_anticipate_floods&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;informal_land_constrained&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s1">&#39;_F&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;defended&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s1">&#39;_P&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;pluvial&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;correct_pluvial&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s1">&#39;_C&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;coastal&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;slr&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s1">&#39;_scenario&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;inc_ineq_scenario&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;pop_growth_scenario&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;fuel_price_scenario&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We also create the associated paths and directories to store outputs</span>
<span class="n">path_simul</span> <span class="o">=</span> <span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span>
<span class="n">path_output_plots</span> <span class="o">=</span> <span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/plots/&#39;</span>
<span class="n">path_output_tables</span> <span class="o">=</span> <span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/tables/&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_simul</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_output_plots</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_output_tables</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[WinError 183] Cannot create a file when that file already exists: &#39;../Output/floods10_F0_P11_C11_scenario232&#39;
[WinError 183] Cannot create a file when that file already exists: &#39;../Output/floods10_F0_P11_C11_scenario232/plots/&#39;
[WinError 183] Cannot create a file when that file already exists: &#39;../Output/floods10_F0_P11_C11_scenario232/tables/&#39;
</pre></div></div>
</div>
</div>
<div class="section" id="Load-data">
<h2>Load data<a class="headerlink" href="#Load-data" title="Permalink to this heading"></a></h2>
<div class="section" id="Basic-geographic-data">
<h3>Basic geographic data<a class="headerlink" href="#Basic-geographic-data" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inputs.data</span> <span class="k">as</span> <span class="nn">inpdt</span>
<span class="n">grid</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_grid</span><span class="p">(</span><span class="n">path_data</span><span class="p">)</span>
<span class="n">amenities</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_amenities</span><span class="p">(</span><span class="n">path_precalc_inp</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<span class="n">geo_grid</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="s2">&quot;grid_reference_500.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Macro-data">
<h3>Macro data<a class="headerlink" href="#Macro-data" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inputs.data</span> <span class="k">as</span> <span class="nn">inpdt</span>
<span class="p">(</span><span class="n">interest_rate</span><span class="p">,</span> <span class="n">population</span><span class="p">,</span> <span class="n">housing_type_data</span><span class="p">,</span> <span class="n">total_RDP</span>
 <span class="p">)</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_macro_data</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">path_scenarios</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Households-and-income-data">
<h3>Households and income data<a class="headerlink" href="#Households-and-income-data" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inputs.data</span> <span class="k">as</span> <span class="nn">inpdt</span>
<span class="n">income_class_by_housing_type</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_hypothesis_housing_type</span><span class="p">()</span>

<span class="p">(</span><span class="n">mean_income</span><span class="p">,</span> <span class="n">households_per_income_class</span><span class="p">,</span> <span class="n">average_income</span><span class="p">,</span> <span class="n">income_mult</span><span class="p">,</span>
 <span class="n">income_2011</span><span class="p">,</span> <span class="n">households_per_income_and_housing</span>
 <span class="p">)</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_income_classes_data</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">path_data</span><span class="p">)</span>

<span class="c1"># NB: we create this parameter to maintain money illusion in simulations</span>
<span class="c1"># (see eqsim.run_simulation function)</span>
<span class="n">param</span><span class="p">[</span><span class="s2">&quot;income_year_reference&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_income</span>

<span class="c1"># Other data at SP (small place) level used for calibration and validation</span>
<span class="p">(</span><span class="n">data_rdp</span><span class="p">,</span> <span class="n">housing_types_sp</span><span class="p">,</span> <span class="n">data_sp</span><span class="p">,</span> <span class="n">mitchells_plain_grid_2011</span><span class="p">,</span>
 <span class="n">grid_formal_density_HFA</span><span class="p">,</span> <span class="n">threshold_income_distribution</span><span class="p">,</span> <span class="n">income_distribution</span><span class="p">,</span>
 <span class="n">cape_town_limits</span><span class="p">)</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_households_data</span><span class="p">(</span><span class="n">path_precalc_inp</span><span class="p">)</span>

<span class="c1"># Import nb of households per pixel, by housing type (from SAL data)</span>
<span class="c1"># NB: RDP housing is included in formal, and there are both formal and informal</span>
<span class="c1"># backyards</span>
<span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;convert_sal_data&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">housing_types</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_sal_data</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span>
                                          <span class="n">housing_type_data</span><span class="p">)</span>
<span class="n">housing_types</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;housing_types_grid_sal.xlsx&#39;</span><span class="p">)</span>
<span class="n">housing_types</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">housing_types</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Land-use-projections">
<h3>Land use projections<a class="headerlink" href="#Land-use-projections" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We import basic projections</span>
<span class="kn">import</span> <span class="nn">inputs.data</span> <span class="k">as</span> <span class="nn">inpdt</span>
<span class="p">(</span><span class="n">spline_RDP</span><span class="p">,</span> <span class="n">spline_estimate_RDP</span><span class="p">,</span> <span class="n">spline_land_RDP</span><span class="p">,</span>
 <span class="n">spline_land_backyard</span><span class="p">,</span> <span class="n">spline_land_informal</span><span class="p">,</span> <span class="n">spline_land_constraints</span><span class="p">,</span>
 <span class="n">number_properties_RDP</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
     <span class="n">inpdt</span><span class="o">.</span><span class="n">import_land_use</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">data_rdp</span><span class="p">,</span> <span class="n">housing_types</span><span class="p">,</span>
                           <span class="n">housing_type_data</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">)</span>
     <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="For-reference,-let-us-visualize-the-informal-settlement-risks-considered">
<h4>For reference, let us visualize the informal settlement risks considered<a class="headerlink" href="#For-reference,-let-us-visualize-the-informal-settlement-risks-considered" title="Permalink to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First for timing</span>
<span class="n">informal_risks_short</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_SHORT.csv&#39;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">informal_risks_short</span> <span class="o">=</span> <span class="n">informal_risks_short</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="s2">&quot;area_short&quot;</span><span class="p">})</span>
<span class="n">informal_risks_medium</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_MEDIUM.csv&#39;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">informal_risks_medium</span> <span class="o">=</span> <span class="n">informal_risks_medium</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="s2">&quot;area_medium&quot;</span><span class="p">})</span>
<span class="n">informal_risks_long</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_LONG.csv&#39;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">informal_risks_long</span> <span class="o">=</span> <span class="n">informal_risks_long</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="s2">&quot;area_long&quot;</span><span class="p">})</span>

<span class="n">informal_risks_timing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">informal_risks_short</span><span class="p">[</span><span class="s2">&quot;area_short&quot;</span><span class="p">],</span>
     <span class="n">informal_risks_medium</span><span class="p">[</span><span class="s2">&quot;area_medium&quot;</span><span class="p">],</span>
     <span class="n">informal_risks_long</span><span class="p">[</span><span class="s2">&quot;area_long&quot;</span><span class="p">]],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;area_short&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;area_medium&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;area_long&quot;</span><span class="p">])</span>
<span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
<span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">informal_risks_timing</span><span class="p">[</span>
    <span class="s2">&quot;argmax&quot;</span><span class="p">][</span><span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span>
        <span class="n">informal_risks_timing</span><span class="p">[[</span><span class="s2">&quot;area_short&quot;</span><span class="p">,</span> <span class="s2">&quot;area_medium&quot;</span><span class="p">,</span> <span class="s2">&quot;area_long&quot;</span><span class="p">]],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tab:grey&quot;</span>
<span class="n">informal_risks_timing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tab:red&quot;</span>
<span class="n">informal_risks_timing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tab:blue&quot;</span>
<span class="n">informal_risks_timing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tab:green&quot;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">Map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">c</span><span class="o">=</span><span class="n">informal_risks_timing</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
                  <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">custom_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:green&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">custom_lines</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Short&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">],</span>
           <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.925</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Timing of informal settlement expansion risk&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s2">&quot;informal_settlement_risk_timing&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">informal_risks_timing</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_input_tables</span>
                             <span class="o">+</span> <span class="s1">&#39;informal_settlement_risk_timing.csv&#39;</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s2">&quot;informal_settlement_risk_timing.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_36_0.png" src="_images/main_nb_36_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Then for probability</span>

<span class="n">informal_risks_LOW</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_pLOW.csv&#39;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">informal_risks_LOW</span> <span class="o">=</span> <span class="n">informal_risks_LOW</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="s2">&quot;area_LOW&quot;</span><span class="p">})</span>
<span class="n">informal_risks_MEDIUM</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_pMEDIUM.csv&#39;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">informal_risks_MEDIUM</span> <span class="o">=</span> <span class="n">informal_risks_MEDIUM</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="s2">&quot;area_MEDIUM&quot;</span><span class="p">})</span>
<span class="n">informal_risks_HIGH</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_pHIGH.csv&#39;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">informal_risks_HIGH</span> <span class="o">=</span> <span class="n">informal_risks_HIGH</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="s2">&quot;area_HIGH&quot;</span><span class="p">})</span>
<span class="n">informal_risks_VERYHIGH</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_pVERYHIGH.csv&#39;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">informal_risks_VERYHIGH</span> <span class="o">=</span> <span class="n">informal_risks_VERYHIGH</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="s2">&quot;area_VERYHIGH&quot;</span><span class="p">})</span>

<span class="n">informal_risks_proba</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">informal_risks_LOW</span><span class="p">[</span><span class="s2">&quot;area_LOW&quot;</span><span class="p">],</span>
     <span class="n">informal_risks_MEDIUM</span><span class="p">[</span><span class="s2">&quot;area_MEDIUM&quot;</span><span class="p">],</span>
     <span class="n">informal_risks_HIGH</span><span class="p">[</span><span class="s2">&quot;area_HIGH&quot;</span><span class="p">],</span>
     <span class="n">informal_risks_VERYHIGH</span><span class="p">[</span><span class="s2">&quot;area_VERYHIGH&quot;</span><span class="p">]],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;area_LOW&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;area_MEDIUM&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;area_HIGH&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;area_VERYHIGH&quot;</span><span class="p">])</span>
<span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
<span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">informal_risks_proba</span><span class="p">[</span>
    <span class="s2">&quot;argmax&quot;</span><span class="p">][</span><span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span>
        <span class="n">informal_risks_proba</span><span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;area_LOW&quot;</span><span class="p">,</span> <span class="s2">&quot;area_MEDIUM&quot;</span><span class="p">,</span> <span class="s2">&quot;area_HIGH&quot;</span><span class="p">,</span> <span class="s2">&quot;area_VERYHIGH&quot;</span><span class="p">]</span>
            <span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tab:grey&quot;</span>
<span class="n">informal_risks_proba</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tab:green&quot;</span>
<span class="n">informal_risks_proba</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tab:blue&quot;</span>
<span class="n">informal_risks_proba</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tab:orange&quot;</span>
<span class="n">informal_risks_proba</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;argmax&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tab:red&quot;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">Map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">c</span><span class="o">=</span><span class="n">informal_risks_proba</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
                  <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">custom_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:green&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:orange&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">custom_lines</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s2">&quot;Very high&quot;</span><span class="p">],</span>
           <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.925</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Probability of informal settlement expansion risk&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s2">&quot;informal_settlement_risk_proba&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">informal_risks_proba</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_input_tables</span>
                            <span class="o">+</span> <span class="s1">&#39;informal_settlement_risk_proba.csv&#39;</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s2">&quot;informal_settlement_risk_proba.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_37_0.png" src="_images/main_nb_37_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We correct areas for each housing type at baseline year for the amount of</span>
<span class="c1"># constructible land in each type</span>
<span class="kn">import</span> <span class="nn">inputs.data</span> <span class="k">as</span> <span class="nn">inpdt</span>
<span class="n">coeff_land</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_coeff_land</span><span class="p">(</span>
    <span class="n">spline_land_constraints</span><span class="p">,</span> <span class="n">spline_land_backyard</span><span class="p">,</span> <span class="n">spline_land_informal</span><span class="p">,</span>
    <span class="n">spline_land_RDP</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Let-us-visualize-land-availaibility-ay-baseline-year-(2011)">
<h4>Let us visualize land availaibility ay baseline year (2011)<a class="headerlink" href="#Let-us-visualize-land-availaibility-ay-baseline-year-(2011)" title="Permalink to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formal private housing</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">coeff_land_FP_map</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">coeff_land</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_input_plots</span><span class="p">,</span> <span class="s1">&#39;coeff_land_formal&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Land availability (in %) for formal private housing&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lbnd</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s2">&quot;coeff_land_formal.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
coeff_land_formal done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_40_1.png" src="_images/main_nb_40_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal backyards</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">coeff_land_IB_map</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">coeff_land</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_input_plots</span><span class="p">,</span> <span class="s1">&#39;coeff_land_backyard&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Land availability (in %) for informal backyard housing&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lbnd</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s2">&quot;coeff_land_backyard.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
coeff_land_backyard done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_41_1.png" src="_images/main_nb_41_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal settlements</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">coeff_land_IS_map</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">coeff_land</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_input_plots</span><span class="p">,</span> <span class="s1">&#39;coeff_land_informal&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Land availability (in %) for informal settlement housing&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lbnd</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s2">&quot;coeff_land_informal.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
coeff_land_informal done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_42_1.png" src="_images/main_nb_42_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formal subsidized housing</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">coeff_land_FS_map</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">coeff_land</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_input_plots</span><span class="p">,</span> <span class="s1">&#39;coeff_land_subsidized&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Land availability (in %) for formal subsidized housing&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lbnd</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s2">&quot;coeff_land_subsidized.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
coeff_land_subsidized done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_43_1.png" src="_images/main_nb_43_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We also import housing heigth limits</span>
<span class="kn">import</span> <span class="nn">inputs.data</span> <span class="k">as</span> <span class="nn">inpdt</span>
<span class="n">housing_limit</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_housing_limit</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We update parameter vector with construction parameters</span>
<span class="c1"># (relies on loaded data) and compute other variables</span>
<span class="kn">import</span> <span class="nn">inputs.parameters_and_options</span> <span class="k">as</span> <span class="nn">inpprm</span>
<span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">minimum_housing_supply</span><span class="p">,</span> <span class="n">agricultural_rent</span>
 <span class="p">)</span> <span class="o">=</span> <span class="n">inpprm</span><span class="o">.</span><span class="n">import_construction_parameters</span><span class="p">(</span>
    <span class="n">param</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">housing_types_sp</span><span class="p">,</span> <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;dwelling_size&quot;</span><span class="p">],</span>
    <span class="n">mitchells_plain_grid_2011</span><span class="p">,</span> <span class="n">grid_formal_density_HFA</span><span class="p">,</span> <span class="n">coeff_land</span><span class="p">,</span>
    <span class="n">interest_rate</span><span class="p">,</span> <span class="n">options</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Import-flood-data-(takes-some-time-when-agents-anticipate-floods)">
<h3>Import flood data (takes some time when agents anticipate floods)<a class="headerlink" href="#Import-flood-data-(takes-some-time-when-agents-anticipate-floods)" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inputs.data</span> <span class="k">as</span> <span class="nn">inpdt</span>
<span class="c1"># If agents anticipate floods, we return output from damage functions</span>
<span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;agents_anticipate_floods&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">,</span> <span class="n">structural_damages_small_houses</span><span class="p">,</span>
     <span class="n">structural_damages_medium_houses</span><span class="p">,</span> <span class="n">structural_damages_large_houses</span><span class="p">,</span>
     <span class="n">content_damages</span><span class="p">,</span> <span class="n">structural_damages_type1</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span>
     <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span>
     <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="n">structural_damages_type4b</span>
     <span class="p">)</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_full_floods_data</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span>
                                       <span class="n">housing_type_data</span><span class="p">)</span>

<span class="c1"># Else, we set those outputs as zero</span>
<span class="c1"># NB: 24014 is the number of grid pixels</span>
<span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;agents_anticipate_floods&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">fraction_capital_destroyed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_formal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_informal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_subsidized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_backyard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_backyards&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_backyards&quot;</span>
                               <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_settlements&quot;</span>
                               <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FU_5yr
FU_10yr
FU_20yr
FU_50yr
FU_75yr
FU_100yr
FU_200yr
FU_250yr
FU_500yr
FU_1000yr
P_5yr
P_10yr
P_20yr
P_50yr
P_75yr
P_100yr
P_200yr
P_250yr
P_500yr
P_1000yr
C_MERITDEM_1_0000
C_MERITDEM_1_0002
C_MERITDEM_1_0005
C_MERITDEM_1_0010
C_MERITDEM_1_0025
C_MERITDEM_1_0050
C_MERITDEM_1_0100
C_MERITDEM_1_0250
Contents in private formal
Contents in informal settlements
Contents in (any) backyard
Contents in formal subsidized
Private formal structures (one floor)
Private formal structures (two floors)
Formal subsidized structures (one floor)
Formal subsidized structures (two floors)
Informal settlement structures
Informal backyard structures
Formal backyard structures (one floor)
Formal backyard structures (two floors)
</pre></div></div>
</div>
<div class="section" id="Let-us-visualize-flood-data">
<h4>Let us visualize flood data<a class="headerlink" href="#Let-us-visualize-flood-data" title="Permalink to this heading"></a></h4>
<p>We will first show some flood maps for visual reference, then the associated fractions of capital destroyed computed through damage functions (final damages depend on spatial sorting).</p>
<p>NB: all maps are undefended (do not take protective infrastructure into account), and a return period of 100 years corresponds to a 1% chance of occurrence in a given year.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[163]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fluvial undefended maximum flood depth (in m) for a 100-year return period</span>
<span class="n">ref_flood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_floods</span> <span class="o">+</span> <span class="s2">&quot;FU_100yr&quot;</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">))</span>
<span class="n">ref_flood_depth</span> <span class="o">=</span> <span class="n">ref_flood</span><span class="p">[</span><span class="s2">&quot;flood_depth&quot;</span><span class="p">]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">ref_flood_map_depth</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">ref_flood_depth</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
    <span class="n">path_input_plots</span><span class="p">,</span> <span class="s1">&#39;FU_100yr&#39;</span> <span class="o">+</span> <span class="s1">&#39;_map_depth&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Maximum fluvial flood depth (in m) for a 100-year return period (up to 99.9% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">ref_flood_depth</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ref_flood_depth</span><span class="p">)],</span> <span class="mf">0.999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;FU_100yr&#39;</span> <span class="o">+</span> <span class="s1">&#39;_map_depth.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FU_100yr_map_depth done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[163]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_50_1.png" src="_images/main_nb_50_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[164]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pluvial maximum flood depth (in m) for a 100-year return period</span>
<span class="n">ref_flood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_floods</span> <span class="o">+</span> <span class="s2">&quot;P_100yr&quot;</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">))</span>
<span class="n">ref_flood_depth</span> <span class="o">=</span> <span class="n">ref_flood</span><span class="p">[</span><span class="s2">&quot;flood_depth&quot;</span><span class="p">]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">ref_flood_map_depth</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">ref_flood_depth</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
    <span class="n">path_input_plots</span><span class="p">,</span> <span class="s1">&#39;P_100yr&#39;</span> <span class="o">+</span> <span class="s1">&#39;_map_depth&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Maximum pluvial flood depth (in m) for a 100-year return period (up to 99.9% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">ref_flood_depth</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ref_flood_depth</span><span class="p">)],</span> <span class="mf">0.999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;P_100yr&#39;</span> <span class="o">+</span> <span class="s1">&#39;_map_depth.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
P_100yr_map_depth done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[164]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_51_1.png" src="_images/main_nb_51_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[165]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Coastal maximum flood depth (in m) for a 100-year return period</span>
<span class="n">ref_flood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
    <span class="n">path_floods</span> <span class="o">+</span> <span class="s2">&quot;C_MERITDEM_1_0100&quot;</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">))</span>
<span class="n">ref_flood_depth</span> <span class="o">=</span> <span class="n">ref_flood</span><span class="p">[</span><span class="s2">&quot;flood_depth&quot;</span><span class="p">]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">ref_flood_map_depth</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">ref_flood_depth</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
    <span class="n">path_input_plots</span><span class="p">,</span> <span class="s1">&#39;C_MERITDEM_1_0100&#39;</span> <span class="o">+</span> <span class="s1">&#39;_map_depth&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Maximum coastal flood depth (in m) for a 100-year return period (up to 99.9% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">ref_flood_depth</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ref_flood_depth</span><span class="p">)],</span> <span class="mf">0.999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;C_MERITDEM_1_0100&#39;</span> <span class="o">+</span> <span class="s1">&#39;_map_depth.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
C_MERITDEM_1_0100_map_depth done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[165]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_52_1.png" src="_images/main_nb_52_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[166]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We create the maps for fraction of capital destroyed before plotting them</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">fraction_capital_destroyed</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
    <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
                      <span class="n">path_input_plots</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="s1">&#39;_fract_K_destroyed&#39;</span><span class="p">,</span> <span class="s2">&quot;Calibrated fraction of capital destroyed&quot;</span><span class="p">,</span>
                      <span class="n">path_input_tables</span><span class="p">,</span>
                      <span class="n">ubnd</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
contents_formal_fract_K_destroyed done
contents_informal_fract_K_destroyed done
contents_backyard_fract_K_destroyed done
contents_subsidized_fract_K_destroyed done
structure_formal_1_fract_K_destroyed done
structure_formal_2_fract_K_destroyed done
structure_subsidized_1_fract_K_destroyed done
structure_subsidized_2_fract_K_destroyed done
structure_informal_settlements_fract_K_destroyed done
structure_informal_backyards_fract_K_destroyed done
structure_formal_backyards_fract_K_destroyed done
structure_backyards_fract_K_destroyed done
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[167]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formal private housing structures</span>
<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;structure_formal_1&#39;</span> <span class="o">+</span> <span class="s1">&#39;_fract_K_destroyed.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[167]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_54_0.png" src="_images/main_nb_54_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[168]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal backyard structures</span>
<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;structure_informal_backyards&#39;</span>
      <span class="o">+</span> <span class="s1">&#39;_fract_K_destroyed.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[168]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_55_0.png" src="_images/main_nb_55_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[169]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal settlement structures</span>
<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;structure_informal_settlements&#39;</span> <span class="o">+</span> <span class="s1">&#39;_fract_K_destroyed.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[169]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_56_0.png" src="_images/main_nb_56_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[170]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formal subsidized structures</span>
<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;structure_subsidized_1&#39;</span> <span class="o">+</span> <span class="s1">&#39;_fract_K_destroyed.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[170]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_57_0.png" src="_images/main_nb_57_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[171]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For contents across all housing types</span>
<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;contents_formal&#39;</span> <span class="o">+</span> <span class="s1">&#39;_fract_K_destroyed.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[171]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_58_0.png" src="_images/main_nb_58_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Import-scenarios-(for-time-moving-variables)">
<h3>Import scenarios (for time-moving variables)<a class="headerlink" href="#Import-scenarios-(for-time-moving-variables)" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">equilibrium.functions_dynamic</span> <span class="k">as</span> <span class="nn">eqdyn</span>
<span class="p">(</span><span class="n">spline_agricultural_rent</span><span class="p">,</span> <span class="n">spline_interest_rate</span><span class="p">,</span>
 <span class="n">spline_population_income_distribution</span><span class="p">,</span> <span class="n">spline_inflation</span><span class="p">,</span>
 <span class="n">spline_income_distribution</span><span class="p">,</span> <span class="n">spline_population</span><span class="p">,</span>
 <span class="n">spline_income</span><span class="p">,</span> <span class="n">spline_minimum_housing_supply</span><span class="p">,</span> <span class="n">spline_fuel</span>
 <span class="p">)</span> <span class="o">=</span> <span class="n">eqdyn</span><span class="o">.</span><span class="n">import_scenarios</span><span class="p">(</span><span class="n">income_2011</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">path_scenarios</span><span class="p">,</span>
                            <span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Import-expected-income-net-of-commuting-costs-(for-all-time-periods)">
<h3>Import expected income net of commuting costs (for all time periods)<a class="headerlink" href="#Import-expected-income-net-of-commuting-costs-(for-all-time-periods)" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inputs.data</span> <span class="k">as</span> <span class="nn">inpdt</span>
<span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;compute_net_income&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">t_temp</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">t_temp</span><span class="p">)</span>
        <span class="p">(</span><span class="n">incomeNetOfCommuting</span><span class="p">,</span> <span class="n">modalShares</span><span class="p">,</span> <span class="n">ODflows</span><span class="p">,</span> <span class="n">averageIncome</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">inpdt</span><span class="o">.</span><span class="n">import_transport_data</span><span class="p">(</span>
             <span class="n">grid</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">t_temp</span><span class="p">,</span> <span class="n">households_per_income_class</span><span class="p">,</span> <span class="n">average_income</span><span class="p">,</span>
             <span class="n">spline_inflation</span><span class="p">,</span> <span class="n">spline_fuel</span><span class="p">,</span>
             <span class="n">spline_population_income_distribution</span><span class="p">,</span> <span class="n">spline_income_distribution</span><span class="p">,</span>
             <span class="n">path_precalc_inp</span><span class="p">,</span> <span class="n">path_precalc_transp</span><span class="p">,</span> <span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

<span class="c1"># Load the variable at baseline year</span>
<span class="n">income_net_of_commuting_costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">path_precalc_transp</span> <span class="o">+</span> <span class="s1">&#39;GRID_incomeNetOfCommuting_0.npy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Let-us-visualize-income-net-of-commuting-costs-at-baseline-year">
<h4>Let us visualize income net of commuting costs at baseline year<a class="headerlink" href="#Let-us-visualize-income-net-of-commuting-costs-at-baseline-year" title="Permalink to this heading"></a></h4>
<p>Note that this variable is computed through our commuting choice model, based on calibrated incomes per income group and job center.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[174]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For income group 1</span>
<span class="n">netincome_poor</span> <span class="o">=</span> <span class="n">income_net_of_commuting_costs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">netincome_poor_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">netincome_poor</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_input_plots</span><span class="p">,</span> <span class="s1">&#39;netincome_poor_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Expected annual income net of commuting costs for the poor, in rands (up to the 99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">netincome_poor</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">netincome_poor</span><span class="p">)],</span> <span class="mf">0.99</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;netincome_poor_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
netincome_poor_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[174]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_65_1.png" src="_images/main_nb_65_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[175]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For income group 2</span>
<span class="n">netincome_midpoor</span> <span class="o">=</span> <span class="n">income_net_of_commuting_costs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">netincome_midpoor_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">netincome_midpoor</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_input_plots</span><span class="p">,</span>
    <span class="s1">&#39;netincome_midpoor_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Expected annual income net of commuting costs for the midpoor, in rands (up to the 99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">netincome_midpoor</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">netincome_midpoor</span><span class="p">)],</span> <span class="mf">0.99</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;netincome_midpoor_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
netincome_midpoor_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[175]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_66_1.png" src="_images/main_nb_66_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[177]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For income group 3</span>
<span class="n">netincome_midrich</span> <span class="o">=</span> <span class="n">income_net_of_commuting_costs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">netincome_midrich_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">netincome_midrich</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_input_plots</span><span class="p">,</span>
    <span class="s1">&#39;netincome_midrich_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Expected annual income net of commuting costs for the midrich, in rands (up to the 99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">netincome_midrich</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">netincome_midrich</span><span class="p">)],</span> <span class="mf">0.99</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;netincome_midrich_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
netincome_midrich_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[177]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_67_1.png" src="_images/main_nb_67_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[178]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For income group 4</span>
<span class="n">netincome_rich</span> <span class="o">=</span> <span class="n">income_net_of_commuting_costs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">netincome_rich_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">netincome_rich</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_input_plots</span><span class="p">,</span> <span class="s1">&#39;netincome_rich_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Expected annual income net of commuting costs for the rich, in rands (up to the 99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_input_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">netincome_rich</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">netincome_rich</span><span class="p">)],</span> <span class="mf">0.99</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_input_plots</span> <span class="o">+</span> <span class="s1">&#39;netincome_rich_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
netincome_rich_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[178]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_68_1.png" src="_images/main_nb_68_1.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Compute-initial-state-equilibrium">
<h2>Compute initial state equilibrium<a class="headerlink" href="#Compute-initial-state-equilibrium" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We run the algorithm</span>
<span class="kn">import</span> <span class="nn">equilibrium.compute_equilibrium</span> <span class="k">as</span> <span class="nn">eqcmp</span>
<span class="p">(</span><span class="n">initial_state_utility</span><span class="p">,</span>
 <span class="n">initial_state_error</span><span class="p">,</span>
 <span class="n">initial_state_simulated_jobs</span><span class="p">,</span>
 <span class="n">initial_state_households_housing_types</span><span class="p">,</span>
 <span class="n">initial_state_household_centers</span><span class="p">,</span>
 <span class="n">initial_state_households</span><span class="p">,</span>
 <span class="n">initial_state_dwelling_size</span><span class="p">,</span>
 <span class="n">initial_state_housing_supply</span><span class="p">,</span>
 <span class="n">initial_state_rent</span><span class="p">,</span>
 <span class="n">initial_state_rent_matrix</span><span class="p">,</span>
 <span class="n">initial_state_capital_land</span><span class="p">,</span>
 <span class="n">initial_state_average_income</span><span class="p">,</span>
 <span class="n">initial_state_limit_city</span><span class="p">)</span> <span class="o">=</span> <span class="n">eqcmp</span><span class="o">.</span><span class="n">compute_equilibrium</span><span class="p">(</span>
     <span class="n">fraction_capital_destroyed</span><span class="p">,</span>
     <span class="n">amenities</span><span class="p">,</span>
     <span class="n">param</span><span class="p">,</span>
     <span class="n">housing_limit</span><span class="p">,</span>
     <span class="n">population</span><span class="p">,</span>
     <span class="n">households_per_income_class</span><span class="p">,</span>
     <span class="n">total_RDP</span><span class="p">,</span>
     <span class="n">coeff_land</span><span class="p">,</span>
     <span class="n">income_net_of_commuting_costs</span><span class="p">,</span>
     <span class="n">grid</span><span class="p">,</span>
     <span class="n">options</span><span class="p">,</span>
     <span class="n">agricultural_rent</span><span class="p">,</span>
     <span class="n">interest_rate</span><span class="p">,</span>
     <span class="n">number_properties_RDP</span><span class="p">,</span>
     <span class="n">average_income</span><span class="p">,</span>
     <span class="n">mean_income</span><span class="p">,</span>
     <span class="n">income_class_by_housing_type</span><span class="p">,</span>
     <span class="n">minimum_housing_supply</span><span class="p">,</span>
     <span class="n">param</span><span class="p">[</span><span class="s2">&quot;coeff_A&quot;</span><span class="p">],</span>
     <span class="n">income_2011</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   3%|██                                                                            | 54/2000 [00:01&lt;01:00, 31.98it/s, error_max_abs=0.0183]
</pre></div></div>
</div>
<p>Reminder: income groups are ranked from poorer to richer, and housing types follow the following order: formal-backyard-informal-RDP</p>
<p>Note on outputs (with dimensions in same order as axes):</p>
<p>initial_state_utility = utility for each income group (no RDP) after optimization</p>
<p>initial_state_error = value of error term for each group after optimization</p>
<p>initial_state_simulated_jobs = total number of households per housing type (no RDP) and income group</p>
<p>initial_state_households_housing_types = number of households per housing type (with RDP) per pixel</p>
<p>initial_state_household_centers = number of households per income group per pixel</p>
<p>initial_state_households = number of households in each housing type and income group per pixel</p>
<p>initial_state_dwelling_size = dwelling size (in m²) for each housing type per pixel</p>
<p>initial_state_housing_supply = housing surface built (in m²) per unit of available land (in km²) for each housing type in each pixel</p>
<p>initial_state_rent = average rent (in rands/m²) for each housing type in each pixel</p>
<p>initial_state_rent_matrix = average willingness to pay (in rands) for each housing type (no RDP) and each income group in each pixel</p>
<p>initial_state_capital_land = value of the (housing construction sector) capital stock (in monetary units) per unit of available land (in km²) in each housing type (no RDP) and each selected pixel</p>
<p>initial_state_average_income = average income per income group (not an output of the model)</p>
<p>initial_state_limit_city = indicator dummy for having strictly more than one household per housing type and income group in each pixel</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We create the associated output directory</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[WinError 183] Cannot create a file when that file already exists: &#39;../Output/floods10_F0_P11_C11_scenario232&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We save the output</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_utility.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_utility</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_error.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_error</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_simulated_jobs.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_simulated_jobs</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_households_housing_types.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_households_housing_types</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_household_centers.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_household_centers</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_households.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_households</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_dwelling_size.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_dwelling_size</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_housing_supply.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_housing_supply</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_rent.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_rent</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_rent_matrix.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_rent_matrix</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_capital_land.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_capital_land</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_average_income.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_average_income</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_outputs</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;/initial_state_limit_city.npy&#39;</span><span class="p">,</span>
        <span class="n">initial_state_limit_city</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Let-us-visualize-key-equilibrium-outputs">
<h3>Let us visualize key equilibrium outputs<a class="headerlink" href="#Let-us-visualize-key-equilibrium-outputs" title="Permalink to this heading"></a></h3>
<div class="section" id="Let-us-start-with-population-distribution">
<h4>Let us start with population distribution<a class="headerlink" href="#Let-us-start-with-population-distribution" title="Permalink to this heading"></a></h4>
<p>We first look at sorting across housing types.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[179]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formal private housing</span>
<span class="n">sim_nb_households_formal</span> <span class="o">=</span> <span class="n">initial_state_households_housing_types</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">formal_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">sim_nb_households_formal</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span> <span class="s1">&#39;formal_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Number of households in formal private housing (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">sim_nb_households_formal</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sim_nb_households_formal</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;formal_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
formal_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[179]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_78_1.png" src="_images/main_nb_78_1.png" />
</div>
</div>
<p>Here are a few caveats on how to interpret those results:</p>
<ul class="simple">
<li><p>For a given housing type, residential locations only vary a priori according to their (dis)amenity index, income net of commuting costs, and exposure to flood risks. We do not account for other location-specific exogenous factors, which explains the overall smooth aspect (compared to reality) of our spatial sorting. Besides, land availability is defined negatively by the share of land not available for other housing types, but in reality, this land may also be allocated to other uses, such as
commercial real estate. Therefore, even though we do simulate the model at the grid-cell level, it makes more sense to interpret results at the scale of the neighbourhood.</p></li>
<li><p>The fact that we are not able to replicate some stylized facts for the CoCT should be interpreted in this regard. For instance, we are not able to reproduce the high density on the Atlantic Seaboard, as its amenities do not appear sufficient to offset its distance to the CBD. Likewise, the higher disamenity or higher uncertainty in income calibration for specific areas (such as Khayelitsha or Mitchell’s Plain) could explain why we are not able to reproduce the (formal) density in those areas.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[180]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal backyards</span>
<span class="n">sim_nb_households_backyard</span> <span class="o">=</span> <span class="n">initial_state_households_housing_types</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">backyard_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">sim_nb_households_backyard</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span>
    <span class="s1">&#39;backyard_sim&#39;</span><span class="p">,</span> <span class="s2">&quot;Number of households in informal backyards (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">sim_nb_households_backyard</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sim_nb_households_backyard</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;backyard_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
backyard_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[180]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_80_1.png" src="_images/main_nb_80_1.png" />
</div>
</div>
<p>Remember that backyarding essentially occurs within (exogenous) formal subsidized housing preccints, hence the observed spatial distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[181]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal settlements</span>
<span class="n">sim_nb_households_informal</span> <span class="o">=</span> <span class="n">initial_state_households_housing_types</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">informal_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">sim_nb_households_informal</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span>
    <span class="s1">&#39;informal_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Number of households in informal settlements (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">sim_nb_households_informal</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sim_nb_households_informal</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;informal_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
informal_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[181]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_82_1.png" src="_images/main_nb_82_1.png" />
</div>
</div>
<p>Contrary to formal private housing, we do observe here a granular spatial distribution more in line with the data, that accounts for the fact that informal settlement locations are exogenously set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[182]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formal subsidized housing</span>
<span class="n">data_nb_households_rdp</span> <span class="o">=</span> <span class="n">initial_state_households_housing_types</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">rdp_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">data_nb_households_rdp</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span> <span class="s1">&#39;rdp_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Number of households in formal subsidized housing (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data_nb_households_rdp</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_nb_households_rdp</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;rdp_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
rdp_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[182]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_84_1.png" src="_images/main_nb_84_1.png" />
</div>
</div>
<p>Finally, the spatial distribution for formal subsidized housing is just taken from the data (not simulated).</p>
<p>We then look at sorting across income groups.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[183]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For income group 1</span>
<span class="n">sim_nb_households_poor</span> <span class="o">=</span> <span class="n">initial_state_household_centers</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">poor_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">sim_nb_households_poor</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span> <span class="s1">&#39;poor_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Number of poor households (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">sim_nb_households_poor</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sim_nb_households_poor</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;poor_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
poor_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[183]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_86_1.png" src="_images/main_nb_86_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[184]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For income group 2</span>
<span class="n">sim_nb_households_midpoor</span> <span class="o">=</span> <span class="n">initial_state_household_centers</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">midpoor_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">sim_nb_households_midpoor</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span>
    <span class="s1">&#39;midpoor_sim&#39;</span><span class="p">,</span> <span class="s2">&quot;Number of midpoor households (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">sim_nb_households_midpoor</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sim_nb_households_midpoor</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;midpoor_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
midpoor_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[184]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_87_1.png" src="_images/main_nb_87_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[185]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For income group 3</span>
<span class="n">sim_nb_households_midrich</span> <span class="o">=</span> <span class="n">initial_state_household_centers</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">midrich_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">sim_nb_households_midrich</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span>
    <span class="s1">&#39;midrich_sim&#39;</span><span class="p">,</span> <span class="s2">&quot;Number of midrich households (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">sim_nb_households_midrich</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sim_nb_households_midrich</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;midrich_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
midrich_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[185]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_88_1.png" src="_images/main_nb_88_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[186]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For income group 4</span>
<span class="n">sim_nb_households_rich</span> <span class="o">=</span> <span class="n">initial_state_household_centers</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">rich_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">sim_nb_households_rich</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span> <span class="s1">&#39;rich_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Number of rich households (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">sim_nb_households_rich</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sim_nb_households_rich</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;rich_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
rich_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[186]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_89_1.png" src="_images/main_nb_89_1.png" />
</div>
</div>
<p>Overall, the distribution of the two poorest income groups is in line with what we could expect given their opportunities on the housing market: being (parly or fully) crowded out of the formal private segment, they redirect themselves to the informal segments and the formal subsidized segment (for those eligible).</p>
<p>The second richest group, which makes up the most part of formal private housing dwellers, illustrates the standard urban economics trade-off between job accessibility and high rents / small dwelling sizes, with a peak at mid-distance (abstracting from location specifics).</p>
<p>The richest income group, who has a higher opportunity cost of time (and better job opportunities), crowds out the second richest group near the CBD, but also does locate in more peripheral high-amenity areas where they overbid the second richest group.</p>
</div>
<div class="section" id="We-may-also-look-at-housing-supply-(in-m²)">
<h4>We may also look at housing supply (in m²)<a class="headerlink" href="#We-may-also-look-at-housing-supply-(in-m²)" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We multiply housing supply per unit of available land by the total area</span>
<span class="c1"># of a grid cell to recover absolute values of housing supply in each cell</span>
<span class="n">housing_supply</span> <span class="o">=</span> <span class="n">initial_state_housing_supply</span> <span class="o">*</span> <span class="n">coeff_land</span> <span class="o">*</span> <span class="mf">0.25</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[187]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formal private housing</span>
<span class="n">hsupply_formal</span> <span class="o">=</span> <span class="n">housing_supply</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">hsupply_formal_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">hsupply_formal</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span> <span class="s1">&#39;hsupply_formal_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Total housing supply (in m²) for formal private housing (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">hsupply_formal</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hsupply_formal</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;hsupply_formal_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
hsupply_formal_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[187]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_93_1.png" src="_images/main_nb_93_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[188]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal backyards</span>
<span class="n">hsupply_backyard</span> <span class="o">=</span> <span class="n">housing_supply</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">hsupply_backyard_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">hsupply_backyard</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span>
    <span class="s1">&#39;hsupply_backyard_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Total housing supply (in m²) for informal backyards (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">hsupply_backyard</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hsupply_backyard</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;hsupply_backyard_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
hsupply_backyard_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[188]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_94_1.png" src="_images/main_nb_94_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[189]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal settlements</span>
<span class="n">hsupply_informal</span> <span class="o">=</span> <span class="n">housing_supply</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">hsupply_informal_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">hsupply_informal</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span>
    <span class="s1">&#39;hsupply_informal_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Total housing supply (in m²) for informal settlements (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">hsupply_informal</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hsupply_informal</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;hsupply_informal_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
hsupply_informal_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[189]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_95_1.png" src="_images/main_nb_95_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[190]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formal subsidized housing</span>
<span class="n">hsupply_rdp</span> <span class="o">=</span> <span class="n">housing_supply</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">hsupply_rdp_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">hsupply_rdp</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span> <span class="n">path_output_plots</span><span class="p">,</span> <span class="s1">&#39;hsupply_rdp_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Total housing supply (in m²) for formal subsidized housing (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">hsupply_rdp</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hsupply_rdp</span><span class="p">)],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;hsupply_rdp_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
hsupply_rdp_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[190]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_96_1.png" src="_images/main_nb_96_1.png" />
</div>
</div>
<p>We do observe that informal settlements are somewhat denser than other housing types. This seems to indicate that horizontal densification dominates vertical densification within the context of the CoCT. Indeed, even though formal private housing can be built high, it is less constrained in terms of land availability and can spread out more, leaving some open space. On the contrary, as informal settlements are more constrained and can only expand horizontally, they end up using most of the
available land.</p>
<p>NB: Note that our model does not allow us to disentangle between high structures with small dwelling units and low structures with big dwelling units within the formal private housing sector.</p>
</div>
<div class="section" id="Now,-let-us-look-at-land-prices-(in-rands-/-m²)">
<h4>Now, let us look at land prices (in rands / m²)<a class="headerlink" href="#Now,-let-us-look-at-land-prices-(in-rands-/-m²)" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We first convert our estimates for the average annual rents into land prices</span>
<span class="c1"># based on the zero profit condition for developers</span>
<span class="n">land_rent</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">initial_state_rent</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;coeff_A&quot;</span><span class="p">])</span>
    <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;coeff_a&quot;</span><span class="p">])</span>
    <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;coeff_a&quot;</span><span class="p">]</span>
    <span class="o">*</span> <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;coeff_b&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">interest_rate</span> <span class="o">+</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;depreciation_rate&quot;</span><span class="p">]))</span>
    <span class="o">**</span> <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;coeff_b&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;coeff_a&quot;</span><span class="p">])</span>
    <span class="o">/</span> <span class="n">interest_rate</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[191]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formal private housing</span>
<span class="n">landrent_formal_simul</span> <span class="o">=</span> <span class="n">land_rent</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">landrent_formal_simul</span><span class="p">[</span><span class="n">hsupply_formal</span><span class="o">==</span><span class="mi">0</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hsupply_formal</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">land_price_formal_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">landrent_formal_simul</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
    <span class="n">path_output_plots</span><span class="p">,</span> <span class="s1">&#39;landrent_formal_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Average land prices (in rands / m²) in formal private areas (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">landrent_formal_simul</span><span class="p">[</span><span class="n">landrent_formal_simul</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;landrent_formal_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
landrent_formal_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[191]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_100_1.png" src="_images/main_nb_100_1.png" />
</div>
</div>
<p>Our results conform to the standard urban economics predictions about the overall shape of the housing/land rent/price gradient.</p>
<p>Note that, although we also simulate the average annual rents for informal backyards and settlements, it is not absolutely rigorous to apply the above formula to recover land prices in those areas, as they are considered unfit for development. We still include the plots for reference, that can be interpreted as land prices should such areas become fit for development, keeping constant housing supply and demand (not very realistic).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[194]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal backyards</span>
<span class="n">landrent_backyard_simul</span> <span class="o">=</span> <span class="n">land_rent</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">landrent_backyard_simul</span><span class="p">[</span><span class="n">hsupply_backyard</span><span class="o">==</span><span class="mi">0</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hsupply_backyard</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">land_price_backyard_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">landrent_backyard_simul</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
    <span class="n">path_output_plots</span><span class="p">,</span> <span class="s1">&#39;landrent_backyard_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Average land prices (in rands / m²) in informal backyard areas (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">landrent_backyard_simul</span><span class="p">[</span><span class="n">landrent_backyard_simul</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;landrent_backyard_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
landrent_backyard_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[194]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_103_1.png" src="_images/main_nb_103_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[195]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For informal settlements</span>
<span class="n">landrent_informal_simul</span> <span class="o">=</span> <span class="n">land_rent</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">landrent_informal_simul</span><span class="p">[</span><span class="n">hsupply_informal</span><span class="o">==</span><span class="mi">0</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hsupply_informal</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">land_price_informal_2d_sim</span> <span class="o">=</span> <span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span>
    <span class="n">landrent_informal_simul</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
    <span class="n">path_output_plots</span><span class="p">,</span> <span class="s1">&#39;landrent_informal_2d_sim&#39;</span><span class="p">,</span>
    <span class="s2">&quot;Average land prices (in rands / m²) in informal settlement areas (up to the 99.99% quantile)&quot;</span><span class="p">,</span>
    <span class="n">path_output_tables</span><span class="p">,</span>
    <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">landrent_informal_simul</span><span class="p">[</span><span class="n">landrent_informal_simul</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mf">0.9999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;landrent_informal_2d_sim.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
landrent_informal_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[195]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_104_1.png" src="_images/main_nb_104_1.png" />
</div>
</div>
<p>Note that we cannot estimate land rents for formal subsidized parcels since such housing is exogenous in our model.</p>
</div>
<div class="section" id="Finally,-let-us-look-at-flood-damages-(in-rands)">
<h4>Finally, let us look at flood damages (in rands)<a class="headerlink" href="#Finally,-let-us-look-at-flood-damages-(in-rands)" title="Permalink to this heading"></a></h4>
<p>In the interest of space and for illustrative purposes, we only show results for the formal private sector structures (which are also the biggest in absolute terms).</p>
<p>We redirect the reader to the interface for a more detailed view on other housing submarkets or content damages, with results given as a share of income and distributional impacts, for instance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We first list the flood map labels to be used</span>
<span class="n">fluvialu_floods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FU_5yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_10yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_20yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_50yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_75yr&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;FU_100yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_200yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_250yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_500yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_1000yr&#39;</span><span class="p">]</span>
<span class="n">pluvial_floods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;P_5yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_10yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_20yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_50yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_75yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_100yr&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;P_200yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_250yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_500yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_1000yr&#39;</span><span class="p">]</span>
<span class="n">coastal_floods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C_MERITDEM_1_0000&#39;</span><span class="p">,</span> <span class="s1">&#39;C_MERITDEM_1_0002&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;C_MERITDEM_1_0005&#39;</span><span class="p">,</span> <span class="s1">&#39;C_MERITDEM_1_0010&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;C_MERITDEM_1_0025&#39;</span><span class="p">,</span> <span class="s1">&#39;C_MERITDEM_1_0050&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;C_MERITDEM_1_0100&#39;</span><span class="p">,</span> <span class="s1">&#39;C_MERITDEM_1_0250&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We compute the full values of damaged formal private structures and contents,</span>
<span class="c1"># for each housing type and a representative household</span>
<span class="kn">import</span> <span class="nn">outputs.flood_outputs</span> <span class="k">as</span> <span class="nn">outfld</span>

<span class="n">content_cost</span> <span class="o">=</span> <span class="n">outfld</span><span class="o">.</span><span class="n">compute_content_cost</span><span class="p">(</span>
    <span class="n">initial_state_household_centers</span><span class="p">,</span> <span class="n">initial_state_housing_supply</span><span class="p">,</span>
    <span class="n">income_net_of_commuting_costs</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span>
    <span class="n">fraction_capital_destroyed</span><span class="p">,</span> <span class="n">initial_state_rent</span><span class="p">,</span>
    <span class="n">initial_state_dwelling_size</span><span class="p">,</span> <span class="n">interest_rate</span><span class="p">)</span>

<span class="n">formal_structure_cost</span> <span class="o">=</span> <span class="n">outfld</span><span class="o">.</span><span class="n">compute_formal_structure_cost_method2</span><span class="p">(</span>
        <span class="n">initial_state_rent</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">interest_rate</span><span class="p">,</span> <span class="n">coeff_land</span><span class="p">,</span>
        <span class="n">initial_state_households_housing_types</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;coeff_A&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># From there, we recover aggregate damages associated to each flood type</span>
<span class="c1"># per return period</span>
<span class="kn">import</span> <span class="nn">outputs.flood_outputs</span> <span class="k">as</span> <span class="nn">outfld</span>

<span class="n">fluvialu_damages_2d_sim</span> <span class="o">=</span> <span class="n">outfld</span><span class="o">.</span><span class="n">compute_damages_2d</span><span class="p">(</span>
    <span class="n">fluvialu_floods</span><span class="p">,</span> <span class="n">path_floods</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">content_cost</span><span class="p">,</span>
    <span class="n">sim_nb_households_formal</span><span class="p">,</span> <span class="n">data_nb_households_rdp</span><span class="p">,</span>
    <span class="n">sim_nb_households_informal</span><span class="p">,</span> <span class="n">sim_nb_households_backyard</span><span class="p">,</span>
    <span class="n">initial_state_dwelling_size</span><span class="p">,</span> <span class="n">formal_structure_cost</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span>
    <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span>
    <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span>
    <span class="n">spline_inflation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">path_output_tables</span><span class="p">,</span> <span class="s1">&#39;fluvialu_sim&#39;</span><span class="p">)</span>

<span class="n">pluvial_damages_2d_sim</span> <span class="o">=</span> <span class="n">outfld</span><span class="o">.</span><span class="n">compute_damages_2d</span><span class="p">(</span>
    <span class="n">pluvial_floods</span><span class="p">,</span> <span class="n">path_floods</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">content_cost</span><span class="p">,</span>
    <span class="n">sim_nb_households_formal</span><span class="p">,</span> <span class="n">data_nb_households_rdp</span><span class="p">,</span>
    <span class="n">sim_nb_households_informal</span><span class="p">,</span> <span class="n">sim_nb_households_backyard</span><span class="p">,</span>
    <span class="n">initial_state_dwelling_size</span><span class="p">,</span> <span class="n">formal_structure_cost</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span>
    <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span>
    <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span>
    <span class="n">spline_inflation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">path_output_tables</span><span class="p">,</span> <span class="s1">&#39;pluvial_sim&#39;</span><span class="p">)</span>

<span class="n">coastal_damages_2d_sim</span> <span class="o">=</span> <span class="n">outfld</span><span class="o">.</span><span class="n">compute_damages_2d</span><span class="p">(</span>
    <span class="n">coastal_floods</span><span class="p">,</span> <span class="n">path_floods</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">content_cost</span><span class="p">,</span>
    <span class="n">sim_nb_households_formal</span><span class="p">,</span> <span class="n">data_nb_households_rdp</span><span class="p">,</span>
    <span class="n">sim_nb_households_informal</span><span class="p">,</span> <span class="n">sim_nb_households_backyard</span><span class="p">,</span>
    <span class="n">initial_state_dwelling_size</span><span class="p">,</span> <span class="n">formal_structure_cost</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span>
    <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span>
    <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span>
    <span class="n">spline_inflation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">path_output_tables</span><span class="p">,</span> <span class="s1">&#39;coastal_sim&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FU_5yr
FU_10yr
FU_20yr
FU_50yr
FU_75yr
FU_100yr
FU_200yr
FU_250yr
FU_500yr
FU_1000yr
P_5yr
P_10yr
P_20yr
P_50yr
P_75yr
P_100yr
P_200yr
P_250yr
P_500yr
P_1000yr
C_MERITDEM_1_0000
C_MERITDEM_1_0002
C_MERITDEM_1_0005
C_MERITDEM_1_0010
C_MERITDEM_1_0025
C_MERITDEM_1_0050
C_MERITDEM_1_0100
C_MERITDEM_1_0250
</pre></div></div>
</div>
<p>Then, we get to plot the annualized value of some of those damages</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[206]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For structures damaged by fluvial floods</span>
<span class="n">fluvialu_damages_2d_sim_stacked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
    <span class="p">[</span><span class="n">df</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">fluvialu_damages_2d_sim</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">fluvialu_formal_structure_2d_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">outputs.flood_outputs</span> <span class="k">as</span> <span class="nn">outfld</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24014</span><span class="p">):</span>
    <span class="n">fluvialu_formal_structure_2d_sim</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">outfld</span><span class="o">.</span><span class="n">annualize_damages</span><span class="p">(</span>
        <span class="n">fluvialu_damages_2d_sim_stacked</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;fluvialu&#39;</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span><span class="n">fluvialu_formal_structure_2d_sim</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
                  <span class="n">path_output_plots</span><span class="p">,</span>
                  <span class="s2">&quot;fluvialu_formal_structure_2d_sim&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Annual fluvial flood damages to formal private housing structures (up to 99.9pct R)&quot;</span><span class="p">,</span> <span class="n">path_output_tables</span><span class="p">,</span>
                  <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">fluvialu_formal_structure_2d_sim</span><span class="p">[</span><span class="n">fluvialu_formal_structure_2d_sim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mf">0.999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s2">&quot;fluvialu_formal_structure_2d_sim.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
fluvialu_formal_structure_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[206]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_112_1.png" src="_images/main_nb_112_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[207]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For structures damaged by pluvial floods</span>
<span class="n">pluvial_damages_2d_sim_stacked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
    <span class="p">[</span><span class="n">df</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">pluvial_damages_2d_sim</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">pluvial_formal_structure_2d_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">outputs.flood_outputs</span> <span class="k">as</span> <span class="nn">outfld</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24014</span><span class="p">):</span>
    <span class="n">pluvial_formal_structure_2d_sim</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">outfld</span><span class="o">.</span><span class="n">annualize_damages</span><span class="p">(</span>
        <span class="n">pluvial_damages_2d_sim_stacked</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;pluvial&#39;</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span><span class="n">pluvial_formal_structure_2d_sim</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
                  <span class="n">path_output_plots</span><span class="p">,</span>
                  <span class="s2">&quot;pluvial_formal_structure_2d_sim&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Annual pluvial flood damages to formal private housing structures (up to 99.9pct R)&quot;</span><span class="p">,</span> <span class="n">path_output_tables</span><span class="p">,</span>
                  <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">pluvial_formal_structure_2d_sim</span><span class="p">[</span><span class="n">pluvial_formal_structure_2d_sim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mf">0.999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s2">&quot;pluvial_formal_structure_2d_sim.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pluvial_formal_structure_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[207]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_113_1.png" src="_images/main_nb_113_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[210]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For structures damaged by coastal floods</span>
<span class="n">coastal_damages_2d_sim_stacked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
    <span class="p">[</span><span class="n">df</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">coastal_damages_2d_sim</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">coastal_formal_structure_2d_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24014</span><span class="p">):</span>
    <span class="n">coastal_formal_structure_2d_sim</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">outfld</span><span class="o">.</span><span class="n">annualize_damages</span><span class="p">(</span>
        <span class="n">coastal_damages_2d_sim_stacked</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;coastal&#39;</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">outputs.export_outputs</span> <span class="k">as</span> <span class="nn">outexp</span>
<span class="n">outexp</span><span class="o">.</span><span class="n">export_map</span><span class="p">(</span><span class="n">coastal_formal_structure_2d_sim</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">geo_grid</span><span class="p">,</span>
                  <span class="n">path_output_plots</span><span class="p">,</span>
                  <span class="s2">&quot;coastal_formal_structure_2d_sim&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Annual coastal flood damages to formal private housing structures (up to 99.9pct R)&quot;</span><span class="p">,</span> <span class="n">path_output_tables</span><span class="p">,</span>
                  <span class="n">ubnd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">coastal_formal_structure_2d_sim</span><span class="p">[</span><span class="n">coastal_formal_structure_2d_sim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mf">0.999</span><span class="p">))</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s2">&quot;coastal_formal_structure_2d_sim.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
coastal_formal_structure_2d_sim done
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[210]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_114_1.png" src="_images/main_nb_114_1.png" />
</div>
</div>
<p>As could have been expected from the flood maps, fluvial damages are more acute but also more localized than pluvial damages. Households seem to avoid the worst-affected areas, but are willing to trade off some flood exposure for good locations nearby the CBD (especially regarding fluvial risks). It is worth noting that the biggest pluvial damages occur in such places where flood exposure is not the highest: it is rather the increase in capital value (driven by a relaxed trade-off) that causes
the impact.</p>
<p>The same mechanism seems at play regarding coastal damages, but the estimated damages are well above standard estimates from the literature. This reflects the fact that we use sea-level rise projections based upon the (pessimistic) RCP 8.5 climate change scenario, but also the methodology we use: capital values are determined endogenously through the housing market, and not calibrated to reflect some maximum share of exposed capital at the city-level. As values are typically high near the CBD,
so are damages when floods hit such areas.</p>
</div>
</div>
</div>
<div class="section" id="Run-simulations-for-subsequent-periods-(time-depends-on-timeline-length)">
<h2>Run simulations for subsequent periods (time depends on timeline length)<a class="headerlink" href="#Run-simulations-for-subsequent-periods-(time-depends-on-timeline-length)" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We run the algorithm</span>
<span class="kn">import</span> <span class="nn">equilibrium.run_simulations</span> <span class="k">as</span> <span class="nn">eqsim</span>
<span class="p">(</span><span class="n">simulation_households_center</span><span class="p">,</span>
 <span class="n">simulation_households_housing_type</span><span class="p">,</span>
 <span class="n">simulation_dwelling_size</span><span class="p">,</span>
 <span class="n">simulation_rent</span><span class="p">,</span>
 <span class="n">simulation_households</span><span class="p">,</span>
 <span class="n">simulation_error</span><span class="p">,</span>
 <span class="n">simulation_housing_supply</span><span class="p">,</span>
 <span class="n">simulation_utility</span><span class="p">,</span>
 <span class="n">simulation_deriv_housing</span><span class="p">,</span>
 <span class="n">simulation_T</span><span class="p">)</span> <span class="o">=</span> <span class="n">eqsim</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">(</span>
     <span class="n">t</span><span class="p">,</span>
     <span class="n">options</span><span class="p">,</span>
     <span class="n">param</span><span class="p">,</span>
     <span class="n">grid</span><span class="p">,</span>
     <span class="n">initial_state_utility</span><span class="p">,</span>
     <span class="n">initial_state_error</span><span class="p">,</span>
     <span class="n">initial_state_households</span><span class="p">,</span>
     <span class="n">initial_state_households_housing_types</span><span class="p">,</span>
     <span class="n">initial_state_housing_supply</span><span class="p">,</span>
     <span class="n">initial_state_household_centers</span><span class="p">,</span>
     <span class="n">initial_state_average_income</span><span class="p">,</span>
     <span class="n">initial_state_rent</span><span class="p">,</span>
     <span class="n">initial_state_dwelling_size</span><span class="p">,</span>
     <span class="n">fraction_capital_destroyed</span><span class="p">,</span>
     <span class="n">amenities</span><span class="p">,</span>
     <span class="n">housing_limit</span><span class="p">,</span>
     <span class="n">spline_estimate_RDP</span><span class="p">,</span>
     <span class="n">spline_land_constraints</span><span class="p">,</span>
     <span class="n">spline_land_backyard</span><span class="p">,</span>
     <span class="n">spline_land_RDP</span><span class="p">,</span>
     <span class="n">spline_land_informal</span><span class="p">,</span>
     <span class="n">income_class_by_housing_type</span><span class="p">,</span>
     <span class="n">path_precalc_transp</span><span class="p">,</span>
     <span class="n">spline_RDP</span><span class="p">,</span>
     <span class="n">spline_agricultural_rent</span><span class="p">,</span>
     <span class="n">spline_interest_rate</span><span class="p">,</span>
     <span class="n">spline_population_income_distribution</span><span class="p">,</span>
     <span class="n">spline_inflation</span><span class="p">,</span>
     <span class="n">spline_income_distribution</span><span class="p">,</span>
     <span class="n">spline_population</span><span class="p">,</span>
     <span class="n">spline_income</span><span class="p">,</span>
     <span class="n">spline_minimum_housing_supply</span><span class="p">,</span>
     <span class="n">spline_fuel</span><span class="p">,</span>
     <span class="n">income_2011</span>
     <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
1
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:  75%|██████████████████████████████████████████████████████████▌                   | 1501/2000 [00:36&lt;00:12, 40.80it/s, error_max_abs=0.02]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   3%|█▉                                                                            | 51/2000 [00:01&lt;00:54, 35.75it/s, error_max_abs=0.0176]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   2%|█▋                                                                            | 43/2000 [00:01&lt;00:53, 36.39it/s, error_max_abs=0.0125]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:  12%|████████▉                                                                    | 231/2000 [00:04&lt;00:37, 46.87it/s, error_max_abs=0.0118]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   2%|█▎                                                                            | 34/2000 [00:00&lt;00:44, 43.94it/s, error_max_abs=0.0181]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   2%|█▋                                                                            | 44/2000 [00:00&lt;00:37, 52.18it/s, error_max_abs=0.0189]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   3%|██▏                                                                           | 57/2000 [00:03&lt;02:10, 14.84it/s, error_max_abs=0.0172]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   1%|▌                                                                             | 16/2000 [00:01&lt;02:11, 15.07it/s, error_max_abs=0.0179]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
5
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   3%|██▌                                                                           | 65/2000 [00:04&lt;02:20, 13.79it/s, error_max_abs=0.0143]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   7%|█████                                                                        | 132/2000 [00:08&lt;01:59, 15.60it/s, error_max_abs=0.0162]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
6
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|██▊                                                                           | 71/2000 [00:04&lt;02:08, 14.96it/s, error_max_abs=0.0195]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   2%|█▏                                                                            | 31/2000 [00:02&lt;02:14, 14.68it/s, error_max_abs=0.0188]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
7
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|██▉                                                                           | 74/2000 [00:04&lt;02:09, 14.88it/s, error_max_abs=0.0129]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   2%|█▌                                                                            | 41/2000 [00:02&lt;02:12, 14.79it/s, error_max_abs=0.0175]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
8
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|██▋                                                                           | 70/2000 [00:04&lt;02:13, 14.46it/s, error_max_abs=0.0191]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   2%|█▊                                                                            | 46/2000 [00:02&lt;01:59, 16.34it/s, error_max_abs=0.0194]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
9
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|██▉                                                                           | 74/2000 [00:04&lt;02:09, 14.85it/s, error_max_abs=0.0192]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   2%|█▉                                                                             | 49/2000 [00:03&lt;02:09, 15.03it/s, error_max_abs=0.019]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
10
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|██▊                                                                           | 71/2000 [00:04&lt;02:13, 14.42it/s, error_max_abs=0.0192]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   3%|██                                                                            | 53/2000 [00:03&lt;02:04, 15.68it/s, error_max_abs=0.0196]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
11
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███                                                                             | 77/2000 [00:05&lt;02:10, 14.70it/s, error_max_abs=0.02]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   3%|██▎                                                                           | 58/2000 [00:03&lt;02:04, 15.61it/s, error_max_abs=0.0196]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
12
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███                                                                           | 79/2000 [00:05&lt;02:10, 14.75it/s, error_max_abs=0.0193]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   3%|██▎                                                                           | 60/2000 [00:03&lt;02:04, 15.57it/s, error_max_abs=0.0198]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
13
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███                                                                           | 79/2000 [00:05&lt;02:12, 14.54it/s, error_max_abs=0.0179]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   3%|██▌                                                                           | 65/2000 [00:04&lt;02:02, 15.83it/s, error_max_abs=0.0187]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
14
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███▍                                                                          | 87/2000 [00:05&lt;02:10, 14.68it/s, error_max_abs=0.0194]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|██▊                                                                           | 73/2000 [00:04&lt;02:08, 14.95it/s, error_max_abs=0.0196]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
15
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███▏                                                                          | 83/2000 [00:05&lt;02:15, 14.15it/s, error_max_abs=0.0182]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███▏                                                                          | 81/2000 [00:05&lt;02:03, 15.56it/s, error_max_abs=0.0153]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
16
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███▏                                                                          | 81/2000 [00:05&lt;02:14, 14.28it/s, error_max_abs=0.0188]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███▏                                                                          | 83/2000 [00:05&lt;02:10, 14.65it/s, error_max_abs=0.0183]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
17
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███▎                                                                          | 84/2000 [00:05&lt;02:15, 14.11it/s, error_max_abs=0.0195]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███▌                                                                          | 90/2000 [00:05&lt;01:59, 15.95it/s, error_max_abs=0.0199]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
18
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███▍                                                                          | 88/2000 [00:06&lt;02:11, 14.54it/s, error_max_abs=0.0164]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   5%|███▋                                                                          | 95/2000 [00:06&lt;02:07, 14.92it/s, error_max_abs=0.0196]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
19
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   5%|███▌                                                                          | 92/2000 [00:06&lt;02:20, 13.56it/s, error_max_abs=0.0194]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   5%|████                                                                         | 104/2000 [00:06&lt;02:06, 15.03it/s, error_max_abs=0.0177]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
20
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   5%|███▋                                                                          | 96/2000 [00:06&lt;02:09, 14.69it/s, error_max_abs=0.0196]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   6%|████▎                                                                        | 111/2000 [00:07&lt;01:59, 15.76it/s, error_max_abs=0.0192]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
21
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   5%|███▊                                                                          | 97/2000 [00:06&lt;02:08, 14.85it/s, error_max_abs=0.0173]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   6%|████▌                                                                        | 119/2000 [00:07&lt;02:02, 15.32it/s, error_max_abs=0.0197]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
22
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   5%|███▌                                                                          | 92/2000 [00:06&lt;02:12, 14.41it/s, error_max_abs=0.0198]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   7%|█████                                                                        | 132/2000 [00:08&lt;01:59, 15.64it/s, error_max_abs=0.0168]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
23
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   5%|███▋                                                                            | 91/2000 [00:06&lt;02:06, 15.07it/s, error_max_abs=0.02]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   7%|█████▍                                                                       | 142/2000 [00:08&lt;01:56, 15.99it/s, error_max_abs=0.0196]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
24
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███▎                                                                          | 86/2000 [00:05&lt;02:08, 14.94it/s, error_max_abs=0.0184]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   8%|██████                                                                       | 158/2000 [00:09&lt;01:55, 15.96it/s, error_max_abs=0.0163]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
25
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███                                                                           | 78/2000 [00:05&lt;02:08, 14.98it/s, error_max_abs=0.0171]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:  26%|████████████████████▎                                                          | 515/2000 [00:33&lt;01:37, 15.16it/s, error_max_abs=0.02]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
26
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|██▉                                                                            | 73/2000 [00:04&lt;02:11, 14.68it/s, error_max_abs=0.018]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:  35%|███████████████████████████▏                                                 | 706/2000 [00:45&lt;01:22, 15.63it/s, error_max_abs=0.0196]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
27
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|██▉                                                                           | 76/2000 [00:05&lt;02:10, 14.72it/s, error_max_abs=0.0173]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:  56%|██████████████████████████████████████████▎                                 | 1113/2000 [01:13&lt;00:58, 15.10it/s, error_max_abs=0.0198]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
28
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███                                                                           | 79/2000 [00:05&lt;02:17, 14.01it/s, error_max_abs=0.0186]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02: 100%|███████████████████████████████████████████████████████████████████████████▉| 1999/2000 [02:14&lt;00:00, 14.92it/s, error_max_abs=0.0499]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
29
Simulation without constraint
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   4%|███                                                                           | 79/2000 [00:05&lt;02:21, 13.59it/s, error_max_abs=0.0198]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation with constraint
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
stops when error_max_abs &lt;0.02:   3%|██▏                                                                           | 56/2000 [00:03&lt;02:16, 14.27it/s, error_max_abs=0.0199]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We save the output</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_households_center.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_households_center</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_households_housing_type.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_households_housing_type</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_dwelling_size.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_dwelling_size</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_rent.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_rent</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_households.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_households</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_error.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_error</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_housing_supply.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_housing_supply</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_utility.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_utility</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_deriv_housing.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_deriv_housing</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_simul</span> <span class="o">+</span> <span class="s1">&#39;/simulation_T.npy&#39;</span><span class="p">,</span>
        <span class="n">simulation_T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Output-visualization">
<h3>Output visualization<a class="headerlink" href="#Output-visualization" title="Permalink to this heading"></a></h3>
<p>All the above outputs are available at each period. For reference, we include here some aggregates that evolve over time.</p>
<p>We redirect the reader to the interface for a more detailed view of other aggregates, of which the evolution of flood damages for instance. Note that since flood risks do not evolve through time, the evolution in flood damages is just a function of population growth and spatial sorting.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We set the x-axis of our plots</span>
<span class="n">years_simul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">2011</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Evolution-of-utility-levels-over-the-years">
<h4>Evolution of utility levels over the years<a class="headerlink" href="#Evolution-of-utility-levels-over-the-years" title="Permalink to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years_simul</span><span class="p">,</span> <span class="n">simulation_utility</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;maroon&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Poor&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years_simul</span><span class="p">,</span> <span class="n">simulation_utility</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mid-poor&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years_simul</span><span class="p">,</span> <span class="n">simulation_utility</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mid-rich&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years_simul</span><span class="p">,</span> <span class="n">simulation_utility</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rich&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">StrMethodFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{x:,.0f}</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Utility levels&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;evol_util_levels.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s2">&quot;evol_util_levels.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_123_0.png" src="_images/main_nb_123_0.png" />
</div>
</div>
</div>
<div class="section" id="Evolution-of-population-sorting-across-housing-types">
<h4>Evolution of population sorting across housing types<a class="headerlink" href="#Evolution-of-population-sorting-across-housing-types" title="Permalink to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years_simul</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">simulation_households_housing_type</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Formal&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years_simul</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">simulation_households_housing_type</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Backyard&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years_simul</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">simulation_households_housing_type</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[:,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Informal&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years_simul</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">simulation_households_housing_type</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[:,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;maroon&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Subsidized&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">StrMethodFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{x:,.0f}</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total number of households per housing type&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s1">&#39;evol_nb_households_htype.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">Image</span><span class="p">(</span><span class="n">path_output_plots</span> <span class="o">+</span> <span class="s2">&quot;evol_nb_households_htype.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/main_nb_125_0.png" src="_images/main_nb_125_0.png" />
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="license_rst.html" class="btn btn-neutral float-left" title="License" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="calib_nb.html" class="btn btn-neutral float-right" title="Notebook: run calibration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Thomas Monnier.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>